<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú—ã—Å–ª–∏ –∏ –°–∏–ª–∞</title>
<link rel="apple-touch-icon" sizes="180x180" href="icon.png">
<link rel="icon" type="image/png" sizes="512x512" href="icon.png">
<meta name="theme-color" content="#ffffff">
<style>
body { font-family:sans-serif; padding:20px; transition:background 1s; min-height:100vh; display:flex; flex-direction:column; overflow:hidden; position:relative;}
h1 { text-align:center; margin-bottom:10px;}
button { padding:10px 20px; margin:5px; border:none; border-radius:8px; font-size:16px; cursor:pointer; position:relative; z-index:2;}
#positive { background:#4CAF50; color:white;}
#negative { background:#f44336; color:white;}
#thoughtInput { width:100%; padding:10px; margin:10px 0; font-size:16px; border-radius:5px;}
#thoughts { margin-top:20px; flex-grow:1; overflow-y:auto; z-index:1;}
.thought { padding:10px; margin-bottom:5px; border-radius:5px; transition:transform 0.3s; display:flex; align-items:center; justify-content:space-between; position:relative; color:white; opacity:1;}
.timestamp { font-size:12px; color:rgba(255,255,255,0.7); margin-top:2px;}
.icon { font-size:20px; margin-left:10px; position:relative;}
.btns { display:flex; gap:5px; margin-left:10px;}
.btns button { padding:2px 6px; font-size:14px; border-radius:5px; color:white;}
.edit { background:#2196F3;}
.delete { background:#f44336;}
#counter { margin-top:10px; font-weight:bold; text-align:center; color:white;}
.energy { position:absolute; top:-50px; left:50%; width:20px; height:20px; border-radius:50%; opacity:0.8; pointer-events:none; animation:flow 1.5s forwards; z-index:1;}
@keyframes flow {0%{transform:translate(-50%,0) scale(1); opacity:0.8;}100%{transform:translate(-50%,100vh) scale(0.5); opacity:0;}}
@keyframes appear {0%{transform:translateY(-50px) scale(0.5); opacity:0;}70%{transform:translateY(10px) scale(1.05); opacity:1;}100%{transform:translateY(0) scale(1);}}
button.pulse { animation:pulse 1s infinite alternate;}
@keyframes pulse {0%{transform:scale(1); box-shadow:0 0 5px rgba(255,255,255,0.5);}100%{transform:scale(1.05); box-shadow:0 0 15px rgba(255,255,255,0.9);}}
</style>
</head>
<body>
<h1>–ú—ã—Å–ª–∏ –∏ –°–∏–ª–∞</h1>
<div style="text-align:center;">
  <button id="positive">–î–∞—ë—Ç —Å–∏–ª—ã</button>
  <button id="negative">–ó–∞–±–∏—Ä–∞–µ—Ç —Å–∏–ª—ã</button>
</div>

<input type="text" id="thoughtInput" placeholder="–ó–∞–ø–∏—à–∏ –º—ã—Å–ª—å...">
<button id="saveThought">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º—ã—Å–ª—å</button>
<button id="exportJSON">–≠–∫—Å–ø–æ—Ä—Ç –º—ã—Å–ª–µ–π</button>
<input type="file" id="importJSON" style="display:none;">
<button id="importBtn">–ò–º–ø–æ—Ä—Ç –º—ã—Å–ª–µ–π</button>

<div id="counter"></div>
<div id="thoughts"></div>

<h2 style="color:white; text-align:center;">–î–Ω–µ–≤–Ω–∏–∫ —ç–Ω–µ—Ä–≥–∏–∏</h2>
<canvas id="energyChart" style="max-width:100%; height:200px;"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const body=document.body;
const thoughtsContainer=document.getElementById('thoughts');
const counter=document.getElementById('counter');
const btnPositive=document.getElementById('positive');
const btnNegative=document.getElementById('negative');
let currentType=null;

// —Ñ–æ–Ω –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å—É—Ç–æ–∫
function setBackgroundByTime(){
  const hour=new Date().getHours();
  if(hour>=6&&hour<18) body.style.background='linear-gradient(to bottom, #a0c4ff, #b0bec5)';
  else body.style.background='linear-gradient(to bottom, #1a237e, #283593)';
}
setBackgroundByTime();

function createEnergy(type){
  const energy=document.createElement('div');
  energy.className='energy';
  energy.style.background=type==='positive'?'#4CAF50':'#f44336';
  energy.style.left=(Math.random()*80+10)+'%';
  body.appendChild(energy);
  setTimeout(()=>energy.remove(),1500);
}

function activateEnergy(type){
  currentType=type;
  createEnergy(type);
  body.style.background=type==='positive'?'#d0f0c0':'#f0d0d0';
  alert(type==='positive'?'–≠–Ω–µ—Ä–≥–∏—è –∏ —Å–∏–ª–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã!':'–ú—ã –Ω–∞–±–ª—é–¥–∞–µ–º –∏ –æ—Ç–ø—É—Å–∫–∞–µ–º —ç—Ç—É —ç–Ω–µ—Ä–≥–∏—é.');
  setTimeout(setBackgroundByTime,5000);
  btnPositive.classList.add('pulse');
  btnNegative.classList.add('pulse');
  setTimeout(()=>{btnPositive.classList.remove('pulse'); btnNegative.classList.remove('pulse');},1500);
}
btnPositive.addEventListener('click',()=>activateEnergy('positive'));
btnNegative.addEventListener('click',()=>activateEnergy('negative'));

// –≥—Ä–∞—Ñ–∏–∫
let chart;
function updateChart(){
  const thoughts=JSON.parse(localStorage.getItem('thoughts')||'[]');
  const daily={};
  thoughts.forEach(t=>{
    const date=new Date(t.time).toLocaleDateString();
    if(!daily[date]) daily[date]={positive:0,negative:0};
    daily[date][t.type]++;
  });
  const labels=Object.keys(daily).sort((a,b)=> new Date(a)-new Date(b));
  const positiveData=labels.map(d=>daily[d].positive);
  const negativeData=labels.map(d=>daily[d].negative);
  const ctx=document.getElementById('energyChart').getContext('2d');
  if(chart) chart.destroy();
  chart=new Chart(ctx,{
    type:'line',
    data:{labels,datasets:[
      {label:'–î–∞—ë—Ç —Å–∏–ª—ã', data:positiveData, borderColor:'#4CAF50', backgroundColor:'rgba(76,175,80,0.2)', tension:0.3},
      {label:'–ó–∞–±–∏—Ä–∞–µ—Ç —Å–∏–ª—ã', data:negativeData, borderColor:'#f44336', backgroundColor:'rgba(244,67,54,0.2)', tension:0.3}
    ]},
    options:{
      responsive:true,
      plugins:{legend:{labels:{color:'white'}}},
      scales:{x:{ticks:{color:'white'}},y:{ticks:{color:'white'}}}
    }
  });
}

// –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º—ã—Å–ª–µ–π
function updateThoughts(){
  thoughtsContainer.innerHTML='';
  const thoughts=JSON.parse(localStorage.getItem('thoughts')||'[]');
  thoughts.forEach((t,index)=>{
    const div=document.createElement('div');
    div.className='thought';
    div.style.background=t.type==='positive'?'#4CAF50':'#f44336';
    div.innerHTML=`
      <div>
        <span class="icon">${t.type==='positive'?'‚úÖ':'‚ö°'}</span> ${t.text}
        <div class="timestamp">${t.time}</div>
      </div>
      <div class="btns">
        <button class="edit">‚úèÔ∏è</button>
        <button class="delete">üóëÔ∏è</button>
      </div>
    `;
    div.style.animation='appear 0.5s ease';

    div.querySelector('.edit').addEventListener('click', ()=>{
      const newText=prompt('–ò–∑–º–µ–Ω–∏ –º—ã—Å–ª—å:', t.text);
      if(newText){
        const newType=prompt('–í—ã–±–µ—Ä–∏ —Ç–∏–ø —ç–Ω–µ—Ä–≥–∏–∏: positive/negative', t.type);
        if(newType==='positive'||newType==='negative'){
          const iconSpan=div.querySelector('.icon');
          const newIcon=document.createElement('span');
          newIcon.className='icon';
          newIcon.style.marginLeft='5px';
          newIcon.textContent=newType==='positive'?'‚úÖ':'‚ö°';
          iconSpan.parentNode.insertBefore(newIcon,iconSpan.nextSibling);
          setTimeout(()=>{iconSpan.textContent=newType==='positive'?'‚úÖ':'‚ö°'; newIcon.remove();},800);
          t.text=newText;
          t.type=newType;
          localStorage.setItem('thoughts',JSON.stringify(thoughts));
          updateThoughts();
        }
      }
    });

    div.querySelector('.delete').addEventListener('click', ()=>{
      if(confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –º—ã—Å–ª—å?')){
        thoughts.splice(index,1);
        localStorage.setItem('thoughts',JSON.stringify(thoughts));
        updateThoughts();
      }
    });

    thoughtsContainer.appendChild(div);
  });
  counter.textContent=`–ú—ã—Å–ª–µ–π –≤—Å–µ–≥–æ: ${thoughts.length}`;
  updateChart();
}

// —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º—ã—Å–ª–∏
document.getElementById('saveThought').addEventListener('click', ()=>{
  const input=document.getElementById('thoughtInput');
  if(input.value.trim()===''||!currentType) return;
  const thoughts=JSON.parse(localStorage.getItem('thoughts')||'[]');
  const now=new Date();
  thoughts.unshift({text:input.value.trim(), time:now.toLocaleString(), type:currentType});
  localStorage.setItem('thoughts',JSON.stringify(thoughts));
  input.value='';
  currentType=null;
  updateThoughts();
});

// —ç–∫—Å–ø–æ—Ä—Ç JSON
document.getElementById('exportJSON').addEventListener('click', ()=>{
  const thoughts=localStorage.getItem('thoughts')||'[]';
  const blob=new Blob([thoughts],{type:"application/json"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download='thoughts.json';
  a.click();
  URL.revokeObjectURL(url);
});

// –∏–º–ø–æ—Ä—Ç JSON
document.getElementById('importBtn').addEventListener('click', ()=>{document.getElementById('importJSON').click();});
document.getElementById('importJSON').addEventListener('change', (e)=>{
  const file=e.target.files[0];
  const reader=new FileReader();
  reader.onload=function(){localStorage.setItem('thoughts',reader.result); updateThoughts();}
  reader.readAsText(file);
});

updateThoughts();
</script>
</body>
</html>
